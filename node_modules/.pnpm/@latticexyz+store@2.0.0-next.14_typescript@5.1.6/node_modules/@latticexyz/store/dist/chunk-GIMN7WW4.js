var l={storeImportPath:"@latticexyz/store/src/",userTypesFilename:"common.sol",codegenDirectory:"codegen",codegenIndexFilename:"index.sol"},p={namespace:"",enums:{},userTypes:{}},c={directory:"tables",keySchema:{key:"bytes32"},tableIdArgument:!1,storeArgument:!1,offchainOnly:!1};import{AbiTypes as k,StaticAbiTypes as R}from"@latticexyz/schema-type/deprecated";import{z as r,ZodIssueCode as T}from"zod";import{getDuplicates as g,parseStaticArray as U,STORE_NAME_MAX_LENGTH as z,zObjectName as d,zUserEnum as D,zValueName as b,zNamespace as O,zName as j}from"@latticexyz/config";import{isSchemaAbiType as I,schemaAbiTypes as K}from"@latticexyz/schema-type";var L=d,V=b,_=b,P=d,$=d,u=r.string(),q=r.string(),B=r.record(V,q).default(c.keySchema),h=r.record(_,u).refine(e=>Object.keys(e).length>0,"Table schema may not be empty"),M=u.transform(e=>h.parse({value:e})),w=h.or(M);function Se(e,n){let s={};for(let[t,a]of Object.entries(e))if(I(a))s[t]=a;else if(n[a]!==void 0)s[t]=n[a].internalType;else{let o=U(a);if(!o)throw new Error(`Unexpected type: ${a}`);s[t]=`${o.elementType}[]`}return s}var x=r.object({directory:r.string().default(c.directory),name:j.optional(),tableIdArgument:r.boolean().default(c.tableIdArgument),storeArgument:r.boolean().default(c.storeArgument),dataStruct:r.boolean().optional(),keySchema:B,valueSchema:w,offchainOnly:r.boolean().default(c.offchainOnly)}).transform(e=>(Object.keys(e.valueSchema).length===1?e.dataStruct??=!1:e.dataStruct??=!0,e)),H=u.transform(e=>x.parse({valueSchema:{value:e}})),G=x.or(H),X=r.record(L,G).transform(e=>{for(let n of Object.keys(e)){let s=e[n];s.name=n.slice(0,z),e[n]=s}return e}),Z=r.object({enums:r.record(P,D).default(p.enums)}),J=r.object({filePath:r.string(),internalType:r.enum(K)}),Q=r.object({userTypes:r.record($,J).default(p.userTypes)}),C=r.object({namespace:O.default(p.namespace),storeImportPath:r.string().default(l.storeImportPath),tables:X,userTypesFilename:r.string().default(l.userTypesFilename),codegenDirectory:r.string().default(l.codegenDirectory),codegenIndexFilename:r.string().default(l.codegenIndexFilename)}).merge(Z).merge(Q),fe=C.superRefine(E),Ue=C.catchall(r.any()).superRefine(E);function E(e,n){for(let i of Object.values(e.tables)){let y=Object.keys(i.keySchema),A=Object.keys(i.valueSchema),f=g([...y,...A]);f.length>0&&n.addIssue({code:T.custom,message:`Field and key names within one table must be unique: ${f.join(", ")}`})}let s=Object.keys(e.tables),t=[...Object.keys(e.enums),...Object.keys(e.userTypes)],a=t,o=[...s,...a],m=g(o);m.length>0&&n.addIssue({code:T.custom,message:`Table library names, enum names, user type names must be globally unique: ${m.join(", ")}`});let v=Object.values(e.tables).map(({name:i})=>i),S=g(v);S.length>0&&n.addIssue({code:T.custom,message:`Table names must be unique: ${S.join(", ")}`});for(let i of Object.values(e.tables)){for(let y of Object.values(i.keySchema))F(t,y,n);for(let y of Object.values(i.valueSchema))W(a,t,y,n)}}function W(e,n,s,t){if(!k.includes(s)&&!e.includes(s)){let a=U(s);a?Y(n,a.elementType,a.staticLength,t):t.addIssue({code:T.custom,message:`${s} is not a valid abi type, and is not defined in userTypes`})}}function F(e,n,s){!R.includes(n)&&!e.includes(n)&&s.addIssue({code:T.custom,message:`${n} is not a static type`})}function Y(e,n,s,t){F(e,n,t),s===0?t.addIssue({code:T.custom,message:"Static array length must not be 0"}):s>=2**16&&t.addIssue({code:T.custom,message:"Static array length must be less than 2**16"})}import{mapObject as ee}from"@latticexyz/common/utils";import{resourceToHex as ne}from"@latticexyz/common";function Ce(e){let n={};for(let s of Object.keys(e.tables))n[s]=se(e.tables[s],e.userTypes,Object.keys(e.enums),e.namespace,s);return{tables:n}}function se(e,n,s,t,a){let{keySchema:o,valueSchema:m}=e;return{keySchema:te(o,n,s),valueSchema:re(m,n,s),namespace:t,name:a,tableId:ne({type:e.offchainOnly?"offchainTable":"table",namespace:t,name:a})}}function te(e,n,s){let t=e==null?{key:"bytes32"}:typeof e=="string"?{key:e}:e;return N(t,n,s)}function re(e,n,s){return N(typeof e=="string"?{value:e}:e,n,s)}function N(e,n,s){return ee(e,(t,a)=>{let o=n&&t in n,m=s.includes(t);return{type:o?n[t].internalType:m?"uint8":t,internalType:t}})}export{l as a,p as b,c,w as d,Se as e,G as f,X as g,Z as h,Q as i,fe as j,Ue as k,Ce as l};
//# sourceMappingURL=chunk-GIMN7WW4.js.map